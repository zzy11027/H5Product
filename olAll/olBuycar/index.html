<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
	<title>新春奥运惠  旺势开门红</title>
	<link rel="stylesheet" href="/templates/ol/olBuycar/css/index.css">
	<script src="/templates/ol/olBuycar/js/jquery.min.js"></script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
	<script>
        wx.config({
            debug: false, // 开启调试模式调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印�?
            appId: 'wx1f4f34aec78c00d0', // 必填，公众号的唯一标识
            timestamp: '{$arr.timestamp}', // 必填，生成签名的时间
            nonceStr: '{$arr.noncestr}', // 必填，生成签名的随机
            signature: '{$arr.sha1}',// 必填，签名，见附
            jsApiList: [
                "onMenuShareTimeline",
                "onMenuShareAppMessage"
            ] // 必填，需要使用的JS接口列表，所有JS接口列表见附
        });
        wx.ready(function () {
            wx.onMenuShareAppMessage({
                title: '新春奥运惠  旺势开门红', // 分享标题
                desc: '新年新车新运势 奥铃贺岁有好礼', // 分享描述
                link: 'http://al.douyar.cc/ol/ol_carnival.php', // 分享链接
                imgUrl: 'http://omkds.douyar.cc/templates/ol/olBuycar/img/fxs.jpg', // 分享图标
                type: '', // 分享类型,music、video或link，不填默认为link
                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function () {

                },
                cancel: function () {
                    //alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }

            });
            wx.onMenuShareTimeline({
                title: '购超级队长同款，享五重好礼', // 分享标题
                link: 'http://al.douyar.cc/ol/ol_carnival.php', // 分享链接
                imgUrl: 'http://omkds.douyar.cc/templates/ol/olBuycar/img/fxs.jpg', // 分享图标
                success: function () {

                },
                cancel: function () {
                  //  alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }
            });
        })
    </script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b2afb48f2f20f0b584d5a33849cd0ec1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</head>
<body>
	<div id="but" onclick="Play(this)"></div>
	<audio src="/templates/ol/olBuycar/img/1.mp3" id="music" class="audio" autoplay="autoplay"  loop="loop" preload="auto" >
		你的浏览器不支持video元素
	</audio>
    <input type="hidden" id="token" value="{$token}">
    <input type="hidden" id="openid" value="{$openid}">
    <input type="hidden" id="existence" value="{$existence}">
	<div class="containerss" onclick="Mask()"></div>

	<img src="/templates/ol/olBuycar/img/1.jpg" alt="" width="100%;">

	<div class="but1" onclick="but('奥铃CTS')"></div>
	<div class="but2" onclick="but('奥铃TS')"></div>
	<div class="but3" onclick="but('奥铃捷运')"></div>
	
	<div class="form1">
		<input type="text" class="inp1" placeholder="请输入您的姓名">	
		<input type="text" class="inp2" placeholder="请输入您的电话">	
		<select name="" id="selects1" class="inp3" onchange="change1();">
			<option value="0">请选择省份</option>
			{foreach from=$res item=cate name=name} 
			<option value="{$cate.id}">{$cate.name}</option>
			{/foreach}
		</select>
		<select name="" id="" class="inp4">
			<option value="0">请选择城市</option>
		</select>		
		<div class="tj1" onclick="tj1()"></div>
	</div>

	<div class="succs">
		<div onclick="Obtain()"></div>
	</div>

	<div class="ma">
		<div class=""></div>
		<a href="http://al.douyar.cc/ol/ol_carnival.php"></a>
	</div>



	<script type="text/javascript">
		var w = 375;
		var f = 16;
		var c = document.documentElement.clientWidth;
		var nf = c * f / w;
		document.documentElement.style.fontSize = nf + 'px';
		var aa  = 1;//多次点击判断
		var carname;	
		$(function(){
			$("#but").css("-webkit-animation","rotating 1.5s 0s linear infinite");
		})
		// function Mask(){
		// 	$('.containerss').hide();
		// 	$('.form1').hide();
		// }

		function but(names){
			
				var token = $("#token").val();
				var openid = $("#openid").val();
				carname = names;
				$.ajax({
		            type: 'POST',
		            dataType:'json',
		            url : 'http://al.douyar.cc/ol/ol_carnival.php?step=ifnum',
		            data: {
		            	car_name:carname,
		            	openid:openid,
					},
					beforeSend: function(request) { 
						request.setRequestHeader("Authorization", token); 
					}, 
		            success: function(data){
						if(data.res != 1){
							$('.containerss').show();
							$('.ma').show();
							$('.ma>div').text(data.res);
							return false;
						}else{
							if($('#existence').val() == 2){
								alert('今日已抢空~明天再来抢订吧！');
								return false;
							}
							$('.containerss').show();
							$('.form1').show();
						}
		            }
		   		});
		}
		
		// function but1(names){
		// 	carname = names;
		// 	if($('#existence').val() == 1){
		// 		$('.containerss').show();
		// 		$('.form1').show();
		// 	}else if($('#existence').val() == 2){
		// 		alert('今日已抢空~明天再来抢订吧！');
		// 	}
		// }

		// function but2(names){
		// 	carname = names;
			// if($('#existence').val() == 1){
			// 	$('.containerss').show();
			// 	$('.form1').show();
			// }else if($('#existence').val() == 2){
			// 	alert('今日已抢空~明天再来抢订吧！');
			// }
		// }

		// function but3(names){
		// 	carname = names;
		// 	if($('#existence').val() == 1){
		// 		$('.containerss').show();
		// 		$('.form1').show();
		// 	}else if($('#existence').val() == 2){
		// 		alert('今日已抢空~明天再来抢订吧！');
		// 	}
		// }

		function tj1(){
			if(aa == 1){
			var token = $("#token").val();
			var openid = $("#openid").val();
			var inp1 = $(".inp1").val();
			var inp2 = $(".inp2").val();
			var inp3 = $(".inp3").find("option:selected").text();
			var inp4 = $(".inp4").find("option:selected").text();
			if (inp1=="") {alert("请输入您的姓名");return false;}
			if (inp2=="") {alert("请输入您的电话");return false;}
			var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
	        if (!reg.test(inp2)) {
	            alert("请输入正确的手机号");
	            return false;
	        }
			if (inp3=="" || inp3 == '请选择省份') {alert("请选择省份");return false;}
			if (inp4=="" || inp4 == '请选择城市') {alert("请选择城市");return false;}
			$('.containerss').removeAttr('onclick');
			$.ajax({
	            type: 'POST',
	            dataType:'json',
	            url : 'http://al.douyar.cc/ol/ol_carnival.php?step=info',
	            data: {
	            	inp1:inp1,
	            	inp2:inp2,
	            	inp3:inp3,
	            	inp4:inp4,
	            	car_name:carname,
	            	openid:openid,
				},
				beforeSend: function(request) { 
					request.setRequestHeader("Authorization", token); 
				}, 
	            success: function(data){
	            	if(data.res){
	            		$('.succs').show();
            		}
	            }
	   		});
	   		}
	        aa=2;
	        jump(3);
		}


	    //城市
	    function change1(){
	    	var inp_1 = $("#selects1  option:selected").val();
	    	if (inp_1=="请选择省份") {alert("请选择请选择省份");return false;}
	    	console.log(inp_1);
			$.ajax({
				url : 'http://al.douyar.cc/ol/ol_carnival.php?step=city',
	            type: 'POST',
	            dataType: "json",
	            data: {
	            	inp_1:inp_1,
				},
	            success: function(data){
	            	console.log(data);
					var quname_html = "<option value='请选择城市'>请选择城市</option>";

                    for(var i = 0; i < data.res.length; i++){
                        quname_html += "<option value='"+ data.res[i].id+"'>"+ data.res[i].name +"</option>";
                    }


                	$(".inp4").html(quname_html);
	            }

		   	});
	    }
 	

    // 获取激活码
 	function Obtain(){
		var token = $("#token").val();
		var openid = $("#openid").val();
		$.ajax({
            type: 'POST',
            dataType:'json',
            url : 'http://al.douyar.cc/ol/ol_carnival.php?step=number',
            data: {
            	openid:openid,
            	car_name:carname,
			},
			beforeSend: function(request) { 
				request.setRequestHeader("Authorization", token); 
			}, 
            success: function(data){
            	console.log(data);
            	$('.succs').hide();
            	$('.ma').show();
            	$('.ma>div').text(data.res);
            }
   		});
 	}  

	//禁止点击多次
	function jump(count) { 
	    window.setTimeout(function(){ 
	        count--; 
	        if(count > 0) { 
	            jump(count); 
	        } else { 
	           aa=1; 
	        } 
	    }, 2000); 
	} 

    // 音频播放
    function Play(e) {
        var audio = document.getElementsByClassName('audio')[0];

        console.log(audio.paused);

        if(audio.paused){

    	   audio.play();

            console.log('播放')
            $("#but").css("-webkit-animation","rotating 1.5s 0s linear infinite");

        }else{
			$("#but").css("-webkit-animation","");
    	   audio.pause();

            console.log('暂停')

        }
    }


    // 移动端默认初始化时暂停播放，改为初始化页面时播放
    document.addEventListener('DOMContentLoaded', function () {
        function audioAutoPlay() {

            var audio = document.getElementsByClassName('audio')[0];

                audio.play();

            document.addEventListener("WeixinJSBridgeReady", function () {

                audio.play();

            }, false);

        }

        audioAutoPlay();
    });
	</script>
</body>
</html>