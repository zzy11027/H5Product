<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
	<title></title>
	<link rel="stylesheet" href="/mobile/templates/xcsm6/css/index.css">
	<script src="/mobile/templates/xcsm6/js/jquery.min.js"></script>
	<script src="/mobile/templates/xcsm6/js/rotaryDraw.js"></script>
	<script src="js/region2.js" type="text/javascript"></script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
	<script>
        wx.config({
            debug: false, // 开启调试模式调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印�?
            appId: 'wxa1ef57725e6a43a9', // 必填，公众号的唯一标识
            timestamp: '{$arr.timestamp}', // 必填，生成签名的时间
            nonceStr: '{$arr.noncestr}', // 必填，生成签名的随机
            signature: '{$arr.sha1}',// 必填，签名，见附
            jsApiList: [
                "onMenuShareTimeline",
                "onMenuShareAppMessage"
            ] // 必填，需要使用的JS接口列表，所有JS接口列表见附
        });
        wx.ready(function () {
            wx.onMenuShareAppMessage({
                title: '欧曼自卸车 0利率购车 最高可省3万元非试不可！', // 分享标题
                desc: '线上预约试驾领精美礼品！', // 分享描述
                link: 'http://www.aumantruck.com/mobile/xcsm6.php', // 分享链接
                imgUrl: 'http://www.aumantruck.com/mobile/templates/xcsm6/img/fx.jpg', // 分享图标
                type: '', // 分享类型,music、video或link，不填默认为link
                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function () {

                },
                cancel: function () {
                    //alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }

            });
            wx.onMenuShareTimeline({
                title: '欧曼自卸车 0利率购车 最高可省3万元非试不可！', // 分享标题
                link: 'http://www.aumantruck.com/mobile/xcsm6.php', // 分享链接
                imgUrl: 'http://www.aumantruck.com/mobile/templates/xcsm6/img/fx.jpg', // 分享图标
                success: function () {

                },
                cancel: function () {
                  //  alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }
            });
        })
    </script>
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?12ebce5ddde1b698958bacdd8cce7342";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>
<body>
	<!-- 遮罩层 -->
	<div class="containerss"></div>
	<input type="hidden" id="token" value="{$token}">
	<input type="hidden" id="openid" value="{$openid}">
	<!-- 开屏页 -->
	<div class="index">
		
		<!-- 试驾 -->
		<div class="shijia">

			<input type="text" class="inp_1" placeholder="请输入您的姓名">

			<input type="text" class="inp_2" placeholder="请输入您的电话">


		    <select  id="selProvinces_2" onchange="region.changed(this, 2, 'selCities_2')" name='apply_field3_2' class="inp_3">
	         <option value="">请选择省份</option>
	        <!-- {foreach from=$city_list item=country} -->
	        <option value="{$country.region_id}" <!-- {if $country.region_id eq $fieldData.agency_province}selected{/if}-->{$country.region_name}</option>
	         <!-- {/foreach} -->
		    </select>
		    <select   id="selCities_2" onchange="getDistributors1(1);" name="apply_field4_2" class="inp_4">
		        <option value="">请选择城市</option>
		        <!-- {foreach from=$fieldData.citys item=city} -->
		        <option value="{$city.region_id}" <!-- {if $city.region_id eq $fieldData.agency_city}selected{/if}-->>{$city.region_name}</option>
		        <!-- {/foreach} -->
		    </select>
		    <select  id="apply_field6_2" name="apply_field5_2" class="inp_5">
		     <option value="">请选择经销商</option>
		    <!-- {foreach from=$distributors item=distributor} -->
		    <option value="{$distributor.distributors_id}" <!--{if $fieldData[6] eq $distributor.distributors_id}selected{/if}-->>{$distributor.distributors_name}</option>
		    <!-- {foreachelse} -->
		    <!-- {/foreach} -->
		    </select>

			<!-- <select name="select11" class="inp_3" id="input11"  style="appearance:none;-moz-appearance:none;-webkit-appearance:none;">

				<option>请选择省份</option>
				<option value="0"></option>
				<option value="1"></option>

			</select>
			
			<select name="select22" class="inp_4" id="input22"  style="appearance:none;-moz-appearance:none;-webkit-appearance:none;">

				<option>请选择城市</option>
				<option value="0"></option>
				<option value="1"></option>

			</select>
			
			<select name="select33" class="inp_5" id="input33"  style="appearance:none;-moz-appearance:none;-webkit-appearance:none;">

				<option>请选择经销商</option>
				<option value="0"></option>
				<option value="1"></option>

			</select> -->
			<select name="" id="" class="inp6">
				<option value="0">请选择车型</option>
				<option value="1">欧曼GTL自卸车</option>
			</select>

			<div class="tj2" onclick="tj2()"></div>
		</div>
	</div>


	<script type="text/javascript">
		var w = 375;
		var f = 16;
		var c = document.documentElement.clientWidth;
		var nf = c * f / w;
		document.documentElement.style.fontSize = nf + 'px';
		var aa  = 1;
		function tj2(){
			if(aa == 1){
			var token = $("#token").val();
			var openid = $("#openid").val();
			var inp1 = $(".inp_1").val();
			var inp2 = $(".inp_2").val();
			var inp3 = $("#selProvinces_2").find("option:selected").text();
			var inp4 = $("#selCities_2").find("option:selected").text();
			var inp5 = $("#apply_field6_2").find("option:selected").text();
			var inp6 = $(".inp6").find("option:selected").text();
			// console.log(inp1,inp2,inp3,inp4,inp5,inp6,inp7,inp8)
			if (inp1=="") {alert("请输入您的姓名");return false;}
			if (inp2=="") {alert("请输入您的电话");return false;}
			var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;

	        if (!reg.test(inp2)) {
	            alert("请输入正确的手机号");
	            return false;
	        }

			if (inp3=="" || inp3 == '请选择省份') {alert("请输入省份");return false;}
			if (inp4=="" || inp4 == '请选择城市') {alert("请输入城市");return false;}
			if (inp5=="" || inp5 == '请选择经销商') {alert("请选择经销商");return false;}
			if (inp6=="" || inp6 == '请选择车型') {alert("请选择车型");return false;}

			$.ajax({
	            type: 'POST',
	            dataType:'json',
	            url : 'xcsm6.php?step=insert',
	            data: {
	            	inp1:inp1,
	            	inp2:inp2,
	            	inp3:inp3,
	            	inp4:inp4,
	            	inp5:inp5,
	            	inp6:inp6,
	            	openid:openid,
	            	// type:155,
				},
				beforeSend: function(request) { 
						request.setRequestHeader("Authorization", token); 
				}, 
	            success: function(data){
	            	if(data.type == 1){
	            		alert("恭喜您获得雨伞，请到指定门店领取");
	            	}else if(data.type == 2){
						alert("恭喜您获得水杯，请到指定门店领取");
	            	}else if(data.type == 3){
						alert("恭喜您获得手环，请到指定门店领取");
	            	}else if(data.type == 5){
	            		alert('恭喜您预约成功，请到指定门店参与试驾');
	            	}else if(data.type == 7){
	            		alert('您已预约');
	            	}else{
	            		alert('位置错误');
	            	}
	            }
	   		});
	   		}
        aa=2;
        jump(3);
		}

    function getDistributors(goods_id){
        if(goods_id == 1){
            var prov_obj = document.getElementById("selProvinces_1");
            var prov = prov_obj.options[prov_obj.options.selectedIndex].value;
            var city_obj = document.getElementById("selCities_1");
            var city = city_obj.options[city_obj.options.selectedIndex].value;
        }

        if(city){
            $.ajax({
                type: "GET",
                url: "xcsm.php?step=check_by_region&prov="+prov+"&city="+city+"&is_activity=1&goods_id="+goods_id,
                dataType: 'json',
                success: function (result) {
                    if(result.error == 1){
                        return false;
                    }
                    var content = result.content;
                    var option_html = "";
                    if(content.length>0){
                        for(var i = 0; i < content.length; i++){
                            option_html += "<option value='"+ content[i]['agency_id'] +"'>"+ content[i]['agency_name'] +"</option>";
                        }
                    }else{
                        option_html += "<option value=''>这里提不到车，去隔壁市看看吧</option>";
                    }
                    if(goods_id == 1){
                        $("#apply_field6_1").html(option_html);
                    }

                }
            });
        }

    }


      function getDistributors1(goods_id){
        if(goods_id == 1){
            var prov_obj = document.getElementById("selProvinces_2");
            var prov = prov_obj.options[prov_obj.options.selectedIndex].value;
            var city_obj = document.getElementById("selCities_2");
            var city = city_obj.options[city_obj.options.selectedIndex].value;
        }

        if(city){
            $.ajax({
                type: "GET",
                url: "xcsm.php?step=check_by_region&prov="+prov+"&city="+city+"&is_activity=1&goods_id="+goods_id,
                dataType: 'json',
                success: function (result) {
                    if(result.error == 1){
                        return false;
                    }
                    var content = result.content;
                    var option_html = "";
                    if(content.length>0){
                        for(var i = 0; i < content.length; i++){
                            option_html += "<option value='"+ content[i]['agency_id'] +"'>"+ content[i]['agency_name'] +"</option>";
                        }
                    }else{
                        option_html += "<option value=''>这里提不到车，去隔壁市看看吧</option>";
                    }
                    if(goods_id == 1){
                        $("#apply_field6_2").html(option_html);
                    }

                }
            });
        }

    }
		

//禁止点击多次
function jump(count) { 
    window.setTimeout(function(){ 
        count--; 
        if(count > 0) { 
            jump(count); 
        } else { 
           aa=1; 
        } 
    }, 2000); 
} 

	</script>
</body>
</html>