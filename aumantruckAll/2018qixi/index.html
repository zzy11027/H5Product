<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title>穿越银河，帮牛郎送七夕礼物！</title>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
	<link rel="stylesheet" type="text/css" href="/mobile/templates/2018qixi/css/style.css">
	<link rel="stylesheet" type="text/css" href="/mobile/templates/2018qixi/css/animate.css">
	<script src="/mobile/templates/2018qixi/js/jquery.js"></script>
	<script src="/mobile/templates/2018qixi/js/1.js"></script>
	<script src="/mobile/templates/2018qixi/js/jquery.transit.min.js"></script>
	<script>
        wx.config({
            debug: false, // 开启调试模式调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印�?
            appId: 'wxa1ef57725e6a43a9', // 必填，公众号的唯一标识
            timestamp: '{$arr.timestamp}', // 必填，生成签名的时间
            nonceStr: '{$arr.noncestr}', // 必填，生成签名的随机
            signature: '{$arr.sha1}',// 必填，签名，见附
            jsApiList: [
                "onMenuShareTimeline",
                "scanQRCode",
                "onMenuShareAppMessage",
                "onMenuShareQQ",
                "onMenuShareWeibo",
                "onMenuShareQZone"
            ] // 必填，需要使用的JS接口列表，所有JS接口列表见附
        });
        wx.ready(function () {
            wx.onMenuShareAppMessage({
                title: '穿越银河，帮牛郎送七夕礼物！', // 分享标题
                desc: '{$desc}', // 分享描述
                link: 'http://www.aumantruck.com/mobile/spike_2018qixi.php', // 分享链接
                imgUrl: 'http://www.aumantruck.com/mobile/templates/2018qixi/img/logo.jpg', // 分享图标
                type: '', // 分享类型,music、video或link，不填默认为link
                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function () {
                	var openid = $("#openid").val();
                    $.ajax({
				        type: "POST",
				        url: "/mobile/spike_2018qixi.php?step=zeng",
				        data:{
				        	openid:openid
						},
				        success: function (res) {
				        	alert("分享成功");
				        }
				    });
                },
                cancel: function () {
                    //alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }

            });
            wx.onMenuShareTimeline({
                title: '穿越银河，帮牛郎送七夕礼物！', // 分享标题
                link: 'http://www.aumantruck.com/mobile/spike_2018qixi.php', // 分享链接
                imgUrl: 'http://www.aumantruck.com/mobile/templates/2018qixi/img/logo.jpg', // 分享图标
                success: function () {
                  	var openid = $("#openid").val();
                    $.ajax({
				        type: "POST",
				        url: "/mobile/spike_2018qixi.php?step=zeng",
				        data:{
				        	openid:openid
						},
				        success: function (res) {
				        	alert("分享成功");
				        }
				    });
                },
                cancel: function () {
                  //  alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }
            });
        })
    </script>
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?bfff5f6ba8afbd36d93ff9d7d12d9007";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>

<body>


<div class="main" style="display: block;">
	<input type="hidden"  id="openid" value="{$openid}">
	<input type="hidden"  id="nickname" value="{$nickname}">
	
	<section class="p1">
		
		<!-- 开始按钮 -->
		<!-- <div class="p1-btn-start" {if $user_id } onclick="start()" {else} onclick="denglu()"{/if} > -->
		<div class="p1-btn-start"  onclick="start()"  >
		<img src="/mobile/templates/2018qixi/img/p1-btn-start.png" alt=""></div>

		<!-- 规则按钮 -->
		<div class="gui">


		</div>

		<!-- 规则弹窗 -->
		<div class="gz">

			<!-- 关闭按钮 -->
			<div class="close">

				
			</div>
		</div>

	</section>


	<section class="p2">

		<!-- 分数 -->
		<div class="fen">
			<span>分数</span>
			<p class="p1s">0</p>
		</div>


		<!-- 时间 -->
		<div class="time">
			<span>时间</span>
			<p class="p2s">30</p>
		</div>

		<div class="p2-center">
			<!-- <div class="btn-left"><img src="/mobile/templates/2018qixi/img/btn-left.png" alt=""></div> -->
			<!-- <div class="btn-right"><img src="/mobile/templates/2018qixi/img/btn-right.png"></div> -->

			<div class="p2-car" id="car"></div>
		</div>

		<div class="p2-go"></div>

		<div class="p2-over">

		</div>
	</section>


	<section class="p3">


		<!-- 运送成功 -->
		<div class="form">
		
			<!-- 得分 -->
			<div class="lost-fen">

			</div>

			<!-- 超越 -->
			<div class="lost-cy">

			</div>

			<!-- 姓名电话 -->
			<input type="text" name="" class="inp_1" id="names" placeholder="请输入您的姓名">
			<input type="text" name="" class="inp_2" id="phone" placeholder="请输入您的电话">


			<!-- 抽奖按钮 -->
			<div class="cj" onclick="cj()">


			</div>

			<!-- 奖项 -->
			<div class="pri_1">
				<div class="pri_1_1"></div>
				<img src="/mobile/templates/2018qixi/img/1.png" alt="" class="feng">

				<p>000</p>

				<!-- 点击分享 -->
				<div class="dian">

				</div>

				<!-- 分享 -->
				<div class="fx">
				
					<div class="fx_c">


					</div>

				</div>


			</div>

			<div class="pri_2">
				<div class="pri_2_1"></div>
				<p>000</p>

				<!-- 点击分享 -->
				<div class="dian">

				</div>

				<!-- 分享 -->
				<div class="fx">
				
					<div class="fx_c">


					</div>

				</div>

			</div>

			<div class="pri_3">
				<div class="pri_3_1"></div>
				<p>000</p>

				<!-- 点击分享 -->
				<div class="dian">

				</div>

				<!-- 分享 -->
				<div class="fx">
				
					<div class="fx_c">


					</div>

				</div>

			</div>

			<div class="pri_4">
				<div class="pri_4_1"></div>
				<!-- 在玩一次 -->
				<a href="http://www.aumantruck.com/mobile/spike_2018qixi.php" class="again">


				</a>
			</div>

		</div>
		

		<!-- 运送失败 -->
		<div class="lost">
				<div class="lost_1"></div>
			<!-- 得分 -->
			<div class="lost-fen">

			</div>

			<!-- 点击分享 -->
			<div class="dian">

			</div>

			<!-- 分享 -->
			<div class="fx">
			
				<div class="fx_c">


				</div>

			</div>
		</div>
	</section>
</div>


		<!-- 背景音频 -->
		<audio src="templates/2018qixi/img/1.mp3" id="music" preload="preload" class="audio" autoplay="autoplay"  loop="loop" preload="auto" >
			你的浏览器不支持video元素
		</audio>
		<!-- 错误提示音乐 -->

		<audio src="templates/2018qixi/img/2.mp3" id="musics_1" preload="preload" class="audio_1">
			你的浏览器不支持video元素
		</audio>

		<!--正确提示音乐 -->

		<audio src="templates/2018qixi/img/3.mp3" id="musics" preload="preload" class="audio_2">
			你的浏览器不支持video元素
		</audio>


<script src="/mobile/templates/2018qixi/js/global.js"></script>


<script>

		// 游戏操作汽车
		$('#car').drag({

			before: function(e) {

			},

			process: function(e) {


				// console.log(bi)

			},

			end: function(e) {
				var thi = $(this)
			}

		});


		function denglu() {
        	alert('请先登录');
        	window.location.href = 'checkLogin.php?act=login&step=active&huodong=2018qixi';
    	}

		var w = 375;
		var f = 16;
		var c = document.documentElement.clientWidth;
		var nf = c * f / w;
		document.documentElement.style.fontSize = nf + 'px';


		$("body").on("touchmove",function(e){
			e.preventDefault();
		});


		// 点击弹出规则弹窗
		$('.gui').click(function(){

			$('.gz').fadeIn(500);
			$('.start').hide();
			$('.gui').hide();
		})
		// 关闭按钮
		$('.close').click(function(){

			$('.gz').hide();
			$('.start').show();
			$('.gui').show();
		})


		// 点击分享弹出层
		$('.dian').click(function(){

			$('.fx').show();
		})

		// 关闭分享
		$('.fx_c').click(function(){

			$('.fx').hide();
		})

		// 游戏倒计时
		var con = $('.p2s').text();
		// 分数
		var car = 0;

		// 获取游戏页高度
		var hei = $("body").height();

		// 获取游戏页宽度
		var wid = $("body").width();
		
		// 倒计时游戏
		var sei;
		function start(){	

				var openid = $("#openid").val();
				$.ajax({
			        type: "POST",
			        url: "/mobile/spike_2018qixi.php?step=cha",
			        data:{
			        	openid:openid
					},
			        success: function (res) {
			        	if(res==1){
			        		alert("很遗憾，您的游戏次数已用完，分享游戏再来一次！");
			        		$('.p2s').text('30');
			        		console.log('很遗憾之后，定时器要清除')
			        		clearTimeout(sei)
			        		return false;
			        	}else{
			    			$(".p2").show();
							$(".p1").hide();
							// var center = ($(".p2-center").width()/2) - ($("#car").width()/2);
							// L1 = parseInt(($(".p2-center").width()*0.2) - $("#car").width());
							// L2 = parseInt(($(".p2-center").width()*0.62) - $("#car").width());
							// L3 = parseInt(($(".p2-center").width()*1) - $("#car").width());
							// $("#car").transition({"x":center+"px"});
							// setTimeout(function(){
							// 	$(".p2-go").hide();
							// 	GameStart();
							// },1000);
			        	
							 sei = setTimeout(function(){

								var fen = $('.p1s').text();
								var openid = $("#openid").val();
								var nickname = $("#nickname").val();
								 //判断用户是否到达300分 
								if (fen<300) {		
									$.ajax({
								        type: "POST",
								        url: "/mobile/spike_2018qixi.php?step=jian",
								        data:{
								        	openid:openid
										},
								        success: function (res) {
								        	GameOver();
											$('.p2').hide();
											$('.lost').show();
											$('.lost-fen').text(score);
								        }
								    });
									
								}else{
									
					                $.ajax({
								        type: "POST",
								        url: "/mobile/spike_2018qixi.php?step=insert_bfb",
								        data:{
								        	openid:openid,
								        	fen:fen
										},
								        success: function (res) {
								        	$(".lost-cy").text(res);
								        	GameOver();
											$('.p2').hide();
											$('.form').show();
											$('.lost-fen').text(score);
							wx.onMenuShareAppMessage({
					            title: nickname+'以'+fen+'分的成绩傲视群雄，你敢来挑战他赢取丰厚奖品吗？', // 分享标题
					            desc: '穿越银河，帮牛郎送七夕礼物！', // 分享描述
					            link: 'http://www.aumantruck.com/mobile/spike_2018qixi.php', // 分享链接
					            imgUrl: 'http://www.aumantruck.com/mobile/templates/2018qixi/img/logo.jpg', // 分享图标
					            type: '', // 分享类型,music、video或link，不填默认为link
					            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
					            success: function () {
					                $.ajax({
								        type: "POST",
								        url: "/mobile/spike_2018qixi.php?step=zeng",
								        data:{
								        	openid:openid
										},
								        success: function (res) {
								        	alert("分享成功");
								        }
								    });
					                //alert("分享成功");
					                // 用户确认分享后执行的回调函数
					            },
					            cancel: function () {
					               // alert("取消成功");
					                // 用户取消分享后执行的回调函数
					            }

					        });




								        }
								    });
								}
							},30000);

						 	var a = setInterval(function(){
							// console.log('开始了!!!!!!!')

							con--;
							// console.log(con)
							if(con <= 0){
								clearInterval(a);
								// 倒计时结束游戏
								// $('.p2').hide();
							}
							$('.p2s').text(con)

						},1000)
				 }

			        }
			    })


		}

		// 游戏结束
		function GameOver(){
			// shareData.title = "小轮车我跑了"+score+"米，你行吗？";
			$(".obj").remove();
			stopTimer(t);
			stopTimer(c);

		}

		// 游戏结束
		function stopTimer(t){
			clearTimeout(t);
		}

		var aa = 1;
		function cj(){

			if(aa == 1){
			var openid = $("#openid").val();
			$fen = $('.p1s').text();
			$names = $("#names").val();
			$phone = $("#phone").val();
			if ($names=="请输入您的姓名") {
				alert('请输入您的姓名');
	            return false;
			}
			if ($names=="") {
				alert('请输入您的姓名');
	            return false;
			}
			if ($phone=="") {
				alert('请输入您的电话');
	            return false;
			}
			if ($phone=="请输入您的电话") {
				alert('请输入您的电话');
	            return false;
			}

			var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;

	        if (!reg.test($phone)) {
	            alert("请输入正确的手机号");
	            return false;
	        }

			$.ajax({
	            type: "POST",
	            url: "/mobile/spike_2018qixi.php?step=info",
	            data:{
	            	openid:openid,
	            	name:$names,
	            	phone:$phone
				},
	            success: function (res) {
	            	if(res==1){
						$.ajax({
				            type: "POST",
				            url: "/mobile/spike_2018qixi.php?step=prize",
				            data:{
				            	openid:openid
							},
				            success: function (res){
			            		if(res==1){
			            			$('.pri_2').show();
            						$('.pri_2>p').text(2018);
			            		}
			            		if(res==2){
			            			$('.pri_2').show();
            						$('.pri_2>p').text(999);
			            		}
			            		if(res==3){
			            			$('.pri_2').show();
            						$('.pri_2>p').text(666);
			            		}
			            		if(res==4){
			            			$('.pri_2').show();
            						$('.pri_2>p').text(288);
			            		}
			            		if(res==5){
			            			$('.pri_1').show();
				            		$('.pri_1>p').text(13.14);
				            		var rands = Math.floor(Math.random()*5);
				            		if(rands == 0){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/1.png')
				            		}else if(rands == 1){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/2.png')
				            		}else if(rands == 2){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/3.png')
				            		}else if(rands == 3){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/4.png')
				            		}else if(rands == 4){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/5.png')
				            		}
			            		}
			            		if(res==6){
			            			$('.pri_1').show();
				            		$('.pri_1>p').text(8.8);
				            		var rands = Math.floor(Math.random()*5);
				            		if(rands == 0){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/1.png')
				            		}else if(rands == 1){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/2.png')
				            		}else if(rands == 2){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/3.png')
				            		}else if(rands == 3){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/4.png')
				            		}else if(rands == 4){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/5.png')
				            		}
			            		}
			            		if(res==7){
			            			$('.pri_1').show();
				            		$('.pri_1>p').text(5.2);
				            		var rands = Math.floor(Math.random()*5);
				            		if(rands == 0){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/1.png')
				            		}else if(rands == 1){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/2.png')
				            		}else if(rands == 2){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/3.png')
				            		}else if(rands == 3){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/4.png')
				            		}else if(rands == 4){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/5.png')
				            		}
			            		}
			            		if(res==8){
			            			$('.pri_1').show();
				            		$('.pri_1>p').text(2.68);
				            		var rands = Math.floor(Math.random()*5);
				            		if(rands == 0){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/1.png')
				            		}else if(rands == 1){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/2.png')
				            		}else if(rands == 2){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/3.png')
				            		}else if(rands == 3){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/4.png')
				            		}else if(rands == 4){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/5.png')
				            		}
			            		}
			            		if(res==9){
			            			$('.pri_1').show();
				            		$('.pri_1>p').text(1.28);
				            		var rands = Math.floor(Math.random()*5);
				            		if(rands == 0){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/1.png')
				            		}else if(rands == 1){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/2.png')
				            		}else if(rands == 2){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/3.png')
				            		}else if(rands == 3){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/4.png')
				            		}else if(rands == 4){
				            			$('.feng').attr('src','/mobile/templates/2018qixi/img/5.png')
				            		}
			            		}
			            		if(res==10){
				            		$('.pri_3').show();
				            		$('.pri_3>p').text();
				            	}
				            	if(res == 11){
				            		$('.pri_4').show();
				            	}
				            }
				        });
	            	}
	            }
	        });
	    	a=2;
			jump(3);
			}
		}

		function jump(count) { 
            window.setTimeout(function(){ 
                count--; 
                if(count > 0) { 
                    jump(count); 
                } else { 
                   a=1; 
                } 
            }, 2000); 
        } 

		// 适配华为键盘影响布局的问题
		var h = window.innerHeight;
		var myInput = document.getElementById('names');
		var myInputs = document.getElementById('phone');

		myInput.addEventListener('focus',handler,false);
		myInputs.addEventListener('focus',handlers,false);

		function handler(){
			//console.log(h)
			$('body').height(h);
// 　　		$('body').height($('body')[0].clientHeight);

		}

		function handlers(){
			//alert(h)
			$('body').height(h);
// 　　		$('body').height($('body')[0].clientHeight);

		}



		// 移动端默认初始化时暂停播放，改为初始化页面时播放
		document.addEventListener('DOMContentLoaded', function () {
		    function audioAutoPlay() {

		        var audio = document.getElementsByClassName('audio')[0];

		            audio.play();

		        document.addEventListener("WeixinJSBridgeReady", function () {

		            audio.play();

		        }, false);

		    }

		    audioAutoPlay();
		});




			// 史上巨坑无比的audio
			function playAudio(audio) {
				if (window.WeixinJSBridge) {
					WeixinJSBridge.invoke('getNetworkType', {}, function (e) {
					    audio.play();
					}, false);
				} else {
					document.addEventListener("WeixinJSBridgeReady", function () {
					    WeixinJSBridge.invoke('getNetworkType', {}, function (e) {
					        audio.play();
					    });
					}, false);
				}
				audio.play();
				return false;
    	}



    	$('.pri_1_1').click(function(){
    		window.location.href = 'http://www.aumantruck.com/mobile/spike_2018qixi.php';
    	})
    	$('.pri_2_1').click(function(){
    		window.location.href = 'http://www.aumantruck.com/mobile/spike_2018qixi.php';
    	})
    	$('.pri_3_1').click(function(){
    		window.location.href = 'http://www.aumantruck.com/mobile/spike_2018qixi.php';
    	})
    	$('.pri_4_1').click(function(){
    		window.location.href = 'http://www.aumantruck.com/mobile/spike_2018qixi.php';
    	})
    	$('.lost_1').click(function(){
    		window.location.href = 'http://www.aumantruck.com/mobile/spike_2018qixi.php';
    	})
</script>

</body></html>