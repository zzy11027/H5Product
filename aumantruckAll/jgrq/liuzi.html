<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<!-- viewport视图宽度设置      视图宽度 = 设备宽度， 初始化视图大小    可调整的最大宽度   可调整的最小宽度   用户是否可以调整视图宽度-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
	<title>合伙赚钱，相荐恨晚！</title>
	<link rel="stylesheet" href="/mobile/templates/jgrq/css/liuzi.css">
	<script src="/mobile/templates/jgrq/js/jquery.min.js"></script>
	<script src="js/region9.js" type="text/javascript"></script>
	<script src="/mobile/templates/jgrq/js/register_message.js"></script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?5153d9e21ba9617add22808ebf4e594f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</head>
<body>
	<div class="gz_1">


	</div>
	<!-- 跳转 超级卡车 -->
	<a href="spike_jgrq.php?step=superca&openid={$openid}&u_name={$u_name}" class="a_3"></a>
	<div class="all">

		<input type="hidden" id="openid" value="{$openid}" />
		<input type="hidden" id="u_name" value="{$u_name}">

		<input type="text" class="input-1" id="tjrname" placeholder="" maxlength="5" value="推荐人姓名" onfocus="if(value=='推荐人姓名') {value=''}" onblur="if (value=='') {value='推荐人姓名'}">

		<input type="text" class="input-2" id="tjrtel" placeholder="" value="推荐人电话"   onfocus="if(value=='推荐人电话') {value=''}" onblur="if (value=='') {value='推荐人电话'}">

		<input type="text" class="input-3" id="captcha"  name="captcha" placeholder=""  value="请输入验证码" onfocus="if(value=='请输入验证码') {value=''}" onblur="if (value=='') {value='请输入验证码'}">

		<div id="get_pic_yzm"><img class="tpyz" src="./codea.php?{$rand}" alt="captcha" onClick="this.src='./codea.php?'+Math.random()" width="100%" height="100%" /></div>


		<input type="text" class="input-4"  id="yzm" placeholder="" value="请输入验证码" onfocus="if(value=='请输入验证码') {value=''}" onblur="if (value=='') {value='请输入验证码'}">
		<div id="getYzm" style="background:#8fc400;border-radius: 4px; color: #fff;" onclick="send_capicha_regist()">获取验证码</div>


		<input type="text" class="input-8" id="gcname" placeholder="" maxlength="5" value="请输入购车人的姓名" onfocus="if(value=='请输入购车人的姓名') {value=''}" onblur="if (value=='') {value='请输入购车人的姓名'}">

		<input type="text" class="input-9" id="gctel" placeholder="" value="请输入购车人的电话" onfocus="if(value=='请输入购车人的电话') {value=''}" onblur="if (value=='') {value='请输入购车人的电话'}">

		 <select class="input-10" id="selProvinces_1" onchange="region.changed(this, 2, 'selCities_1')" name='apply_field3_1'>
	         <option value="">省</option>
	        <!-- {foreach from=$city_list item=country} -->
	        <option value="{$country.region_id}" <!-- {if $country.region_id eq $fieldData.agency_province}selected{/if}-->{$country.region_name}</option>
         <!-- {/foreach} -->
    	</select>

    	<select  class="input-11" id="selCities_1" onchange="getDistributors();" name="apply_field4_1">
	        <option value="">城市</option>
	        <!-- {foreach from=$fieldData.citys item=city} -->
	        <option value="{$city.region_id}" <!-- {if $city.region_id eq $fieldData.agency_city}selected{/if}-->>{$city.region_name}</option>
        <!-- {/foreach} -->
    	</select>
		
		<select class="input-15" id="apply_field6_1" name="apply_field5_1">
			<option value="">经销商</option>
		</select> 

<form name="form1">

		<select class="input-12" name="input-12" id="input-12" onChange="getCity()">
			<option value="0">车型</option>
			<option value="1">牵引车</option>
			<option value="2">载货车</option>
    	</select>
    	<select class="input-14" name="input-14" id="input-14">
			<option value="0">车系</option>
<!-- 			<option value="1">欧曼EST-A</option>
			<option value="2">欧曼EST</option>
			<option value="3">欧曼GTL</option>
			<option value="4">欧曼ETX</option> -->

    	</select>

</form>
	<div class="xx">	</div>
		
<!-- 规则弹窗 -->
	<div class="guize">
		
		<div class="close_gz">

		</div>
		<div class="guize_nei">
			
			<img src="/mobile/templates/jgrq/img/xxzz.png" alt="">

		</div>
	</div>


	


	<div class="yes">

	</div>
		 <input type="radio"  name="sex" value="1" class="input-13" />

		 <a class="return" href="JavaScript:history.go(-1)"></a>
		 <div onClick="tj()" class="tj"></div>
	</div>
	<script type="text/javascript">
		var w = 375;
		var f = 16;
		var c = document.documentElement.clientWidth;
		var nf = c * f / w;
		document.documentElement.style.fontSize = nf + 'px';

		var car=[ 
			["欧曼EST-A","欧曼EST","欧曼GTL","欧曼ETX"],
            ["欧曼EST-A","欧曼EST","欧曼GTL"]
            
        ]; 


         function getCity(){  
            var sltCountry=document.getElementsByTagName('select')[3];
            var sltCity=document.getElementsByTagName('select')[4];

            var country=car[sltCountry.selectedIndex-1];
            sltCity.length=1;      

            for(var i=0;i<country.length;i++){  
                sltCity[i+1]=new Option(country[i],country[i]);  
            }  
        } 


		function tj(){

			
			$openid = $("#openid").val();
			$tjrname = $("#tjrname").val();
			$tjrtel = $("#tjrtel").val();
			$captcha = $("#captcha").val();
			$yzm = $("#yzm").val();
			$gcname = $("#gcname").val();
			$gctel = $("#gctel").val();
			$yzm = $("#yzm").val();
			$province = $("#selProvinces_1").find("option:selected").text();
        	$city = $("#selCities_1").find("option:selected").text();
        	$dealer = $("#apply_field6_1").find("option:selected").text();
        	$yxcx = $("#input-14").find("option:selected").text();
        	$yxxl = $("#input-12").find("option:selected").text();
			if (!$tjrname) {
	            alert('请输入推荐人姓名');
	            return false;
	        }
	        if ($tjrname == "推荐人姓名") {
	            alert('请输入推荐人姓名');
	            return false;
	        }
	        if ($captcha == "请输入验证码") {
	            alert('请输入图片验证码');
	            return false;
	        }
	        if ($yzm == "请输入验证码") {
	            alert('请输入验证码');
	            return false;
	        }
	        if ($tjrtel == "推荐人电话") {
	            alert('请输入推荐人手机号');
	            return false;
	        }
	        if ($tjrtel == "推荐人电话") {
	            alert('请输入推荐人手机号');
	            return false;
	        }
	        var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
	        if (!reg.test($tjrtel)) {
	            alert("请输入正确的推荐人手机号");
	            return false;
	        }
	       
	        if (!$gcname) {
	            alert('请输入购车人的姓名');
	            return false;
	        }
	        if ($gcname =="请输入购车人的姓名") {
	            alert('请输入购车人的姓名');
	            return false;
	        }
	        if (!$gctel) {
	            alert('请输入购车人的电话');
	            return false;
	        }
	        if ($gctel =="请输入购车人的电话") {
	            alert('请输入购车人的电话');
	            return false;
	        }
	        var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
	        if (!reg.test($gctel)) {
	            alert("请输入正确的购车人手机号");
	            return false;
	        }
	        if($yzm==''){
               alert("请输入验证码");
              return false;
        	}
	        if($("select[name='apply_field3_1']").val() == ''){
	            alert("请选择省份");
	            return false;
	        }
	        if($province == '省'){
	            alert("请选择省份");
	            return false;
	        }
	        if($city == '市'){
	            alert("请选择市");
	            return false;
	        }
	        if (!$("select[name='apply_field4_1']").val()) {
	            alert('请选择市');
	            return false;
	        }
	        if (!$("select[name='apply_field5_1']").val()) {
	            alert('请选择经销商');
	            return false;
	        }
	        if ($dealer == '经销商') {
	            alert('请选择经销商');
	            return false;
	        }
	        if ($("select[name='input-14']").val() == 0) {
	            alert('请选择车型');
	            return false;
	        }
	        if ($("select[name='input-12']").val() == 0) {
	            alert('请选择车系');
	            return false;
	        }
	        if(!$("input[type='radio']").is(':checked')){
				alert('请勾选同意！')
	            return false;
			}
	        //if(a==0){
			if (capicha_time()) {
				
					$.ajax({
		            type: 'POST',
		            dataType:'text',
		            url : 'spike_jgrq.php?step=tjcl',
		             data: {
		                    "tjrname":$tjrname,
		                    "tjrtel":$tjrtel,
		                    "openid":$openid,
		                    "gcname":$gcname,
		                    "gctel":$gctel,
		                    "province":$province,
		                    "city":$city,
		                    "dealer":$dealer,
		                    "yxcx":$yxcx,
		                    "yxxl":$yxxl,

		                    },
		            success: function(data){
		            	if (data==1) {
		            		alert("提交成功！请到个人中心查看");
		            		window.location.href = 'spike_jgrq.php?step=myself&openid={$openid}&u_name={$u_name}';
		            	}
		            	if (data==9) {
		            		alert("购车人已经推荐过了！");
		            		window.location.href = 'spike_jgrq.php?step=myself&openid={$openid}&u_name={$u_name}';
		            	}
		     
		            }
		        });
					
			} else if (!capicha_time()||$("#yzm").val()=='') {
	             alert('验证码不正确');
	             return false;
	         }
		}

		$(function(){

		var openid = $("#openid").val();
		 wx.config({
            debug: false, // 开启调试模式调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印�?
            appId: 'wxa1ef57725e6a43a9', // 必填，公众号的唯一标识
            timestamp: '{$arr.timestamp}', // 必填，生成签名的时间
            nonceStr: '{$arr.noncestr}', // 必填，生成签名的随机
            signature: '{$arr.sha1}',// 必填，签名，见附
            jsApiList: [
                "onMenuShareTimeline",
                "scanQRCode",
                "onMenuShareAppMessage",
                "onMenuShareQQ",
                "onMenuShareWeibo",
                "onMenuShareQZone"
            ] // 必填，需要使用的JS接口列表，所有JS接口列表见附
        });
        wx.ready(function () {
            wx.onMenuShareAppMessage({
                title: '合伙赚钱，相荐恨晚！全民合伙人荐购大赛第二季强势来袭！', // 分享标题
                desc: '荐购大赛第二季奖励升级，月赚十万，就等你来！', // 分享描述
                link: 'http://www.aumantruck.com/mobile/spike_jgrq.php?step=test&id='+openid, // 分享链接
                imgUrl: 'http://www.aumantruck.com/mobile/templates/jgrq/img/logo.jpg', // 分享图标
                type: '', // 分享类型,music、video或link，不填默认为link
                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function () {
                    //alert("分享成功");
                    // 用户确认分享后执行的回调函数
                },
                cancel: function () {
                    //alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }

            });
            wx.onMenuShareTimeline({
                title: '合伙赚钱，相荐恨晚！全民合伙人荐购大赛第二季强势来袭！', // 分享标题
                link: 'http://www.aumantruck.com/mobile/spike_jgrq.php?step=test&id='+openid, // 分享链接
                imgUrl: 'http://www.aumantruck.com/mobile/templates/jgrq/img/logo.jpg', // 分享图标
                success: function () {
                  //  alert("分享成功");
                    // 用户确认分享后执行的回调函数
                },
                cancel: function () {
                  //  alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }
            });
        })
	});

	function getDistributors(){
		$city = $("#selCities_1").find("option:selected").text();
		if ($city!="城市") {
			$.ajax({
	            type: "POST",
	            url: "spike_jgrq.php?step=dealer",
	            data: {"city":$city},
	            dataType: 'json',
	            success: function (res) {
	               
	                var jxs_html = "";
	                if (res.length>0) {
	                    for(var q = 0; q < res.length; q++){
	                        jxs_html += "<option value='"+ res[q]['id'] +"'>"+ res[q]['dealer'] +"</option>";
	                    }
	                    $("#apply_field6_1").html(jxs_html);
	                }else{
	                    console.log("res");
	                    jxs_html += "<option value=''>这里无法试驾，去隔壁市看看吧</option>";
	                    $("#apply_field6_1").html(jxs_html);
	                }
	                
	                
	            }
	        })
		}

	}

		// 点击出现规则
		$('.xx').click(function(){
			$('.gz_1').fadeIn();
			$('.guize').fadeIn();
			$('.yes').show();
		})

		// 关闭规则弹窗
		$('.close_gz').click(function(){
			$('.gz_1').fadeOut();
			$('.guize').fadeOut();
		})


		$('.yes').click(function(){
			$("input[type='radio']").attr("checked",'checked');
			$('.guize').hide();
		})
	</script>
</body>
</html>