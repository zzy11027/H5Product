<!DOCTYPE html>
<meta charset="UTF-8" />
<link rel="apple-touch-icon" href="content/textures/mobile/apple-touch-icon.png">
<link rel="shortcut icon" href="content/textures/mobile/apple-touch-icon.png">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<script src="/templates/omk/omk_transport/jquery.min.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<link href="content/textures/mobile/apple-touch-startup-image-1536x2008.png"
      media="(device-width: 768px) and (device-height: 1024px)
         and (orientation: portrait)
         and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image">
<!-- iPad, retina, landscape -->
<link href="content/textures/mobile/apple-touch-startup-image-1496x2048.png"
      media="(device-width: 768px) and (device-height: 1024px)
         and (orientation: landscape)
         and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image">
<!-- iPad, portrait -->
<link href="content/textures/mobile/apple-touch-startup-image-768x1004.png"
      media="(device-width: 768px) and (device-height: 1024px)
         and (orientation: portrait)
         and (-webkit-device-pixel-ratio: 1)"
      rel="apple-touch-startup-image">
<!-- iPad, landscape -->
<link href="content/textures/mobile/apple-touch-startup-image-748x1024.png"
      media="(device-width: 768px) and (device-height: 1024px)
         and (orientation: landscape)
         and (-webkit-device-pixel-ratio: 1)"
      rel="apple-touch-startup-image">
<!-- iPhone 5 -->
<link href="content/textures/mobile/apple-touch-startup-image-640x1096.png"
      media="(device-width: 320px) and (device-height: 568px)
         and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image">
<!-- iPhone, retina -->
<link href="content/textures/mobile/apple-touch-startup-image-640x920.png"
      media="(device-width: 320px) and (device-height: 480px)
         and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image">
<!-- iPhone -->
<link href="content/textures/mobile/apple-touch-startup-image-320x460.png"
      media="(device-width: 320px) and (device-height: 480px)
         and (-webkit-device-pixel-ratio: 1)"
      rel="apple-touch-startup-image">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui">
<link rel="stylesheet" href="/templates/omk/omk_transport/css.css">
<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script>
      wx.config({
          debug: false, // 开启调试模式调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印�?
          appId: 'wx20f3f0b302417dcd', // 必填，公众号的唯一标识
          timestamp: '{$arr.timestamp}', // 必填，生成签名的时间
          nonceStr: '{$arr.noncestr}', // 必填，生成签名的随机
          signature: '{$arr.sha1}',// 必填，签名，见附
          jsApiList: [
              "onMenuShareTimeline",
              "onMenuShareAppMessage"
          ] // 必填，需要使用的JS接口列表，所有JS接口列表见附
      });
      wx.ready(function () {
          wx.onMenuShareAppMessage({
              title: '运输技巧大考验', // 分享标题
              desc: '运输比拼赢话费，考验车技的时候到了', // 分享描述
              link: 'http://omk.douyar.cc/omk/omk_tran.php', // 分享链接
              imgUrl: 'http://omk.douyar.cc/templates/omk/omk_transport/img/fx.jpg', // 分享图标
              type: '', // 分享类型,music、video或link，不填默认为link
              dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
              success: function () {

              },
              cancel: function () {
                  //alert("取消成功");
                  // 用户取消分享后执行的回调函数
              }

          });
          wx.onMenuShareTimeline({
              title: '运输技巧大考验', // 分享标题
              link: 'http://omk.douyar.cc/omk/omk_tran.php', // 分享链接
              imgUrl: 'http://omk.douyar.cc/templates/omk/omk_transport/img/fx.jpg', // 分享图标
              type: '', // 分享类型,music、video或link，不填默认为link
              dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
              success: function () {

              },
              cancel: function () {
                //  alert("取消成功");
                  // 用户取消分享后执行的回调函数
              }
          });
      })
  </script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?40ec6ee52e8b369e8c69fd3d085a240c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<style type="text/css">
@font-face {
    font-family: 'chunkfive';
    src: url('content/fonts/chunkfive.eot'); /* IE 5-8 */
    src: local(''),             /* sneakily trick IE */
    url('content/fonts/chunkfive.woff') format('woff'),    /* FF 3.6, Chrome 5, IE9 */
    url('content/fonts/chunkfive.ttf') format('truetype'), /* Opera, Safari */
   
}
</style>
<html>
<head>
<title>运输技巧大考验</title>
<style>
    body{
        margin: 0;
        padding: 0;
        background-color:#fcb040;
        overflow: hidden;
    }
    canvas {
        background: transparent;
        display: block;
        margin: 0;
        padding: 0;
    }
</style>
<script type="text/javascript">
  (function (){
    //updateShare(0);
    })();
  function gotomore(){
    window.location.href="/";
  }  
</script>
<body onload="">
<audio src="/templates/omk/omk_transport/img/1.mp3" id="music" class="audio" autoplay="autoplay"  loop="loop" preload="auto" >
你的浏览器不支持video元素
</audio>

<div id="but" onclick="Play(this)"></div>
<input type="hidden"  id="openid" value="{$openid}">
<input type="hidden"  id="token" value="{$token}">
<input type="hidden"  id="nickname" value="{$nickname}">
<div class="zz"></div>
<div class="index">
  <div class="start"></div>
  <div class="gz"></div>
  <div class="g"></div>
</div>
<div class="cores">
<div class="core">
<p>xxx</p>
<span>12%</span>
<input type="text" class="name" placeholder="请输入您的姓名">
<input type="text" class="phone" placeholder="请输入您的电话">
<div class="tj" onclick="tj1()"></div>
</div>
<div class="prize">
  <p></p>
  <a href="" class="a1"></a>
  <a class="a2"></a>
</div>
<div class="no-prize">
  <a href="" class="a1"></a>
  <a class="a2"></a>
</div>
<div class="f"></div>
</div>

<canvas id="canvas" width="480" height="720" style="width: 100%;height:100%;padding: 0;margin: auto;left:0;right:0;top:0;bottom:0;position:absolute;display: none;"></canvas>
<script src="/templates/omk/omk_transport/game.min.js"></script>
<script  type="text/JavaScript">
var aa  = 1;
var w = 375;
var f = 16;
var c = document.documentElement.clientWidth;
var nf = c * f / w;
document.documentElement.style.fontSize = nf + 'px';
var fen = 0;

// 移动端默认初始化时暂停播放，改为初始化页面时播放
document.addEventListener('DOMContentLoaded', function () {
    function audioAutoPlay() {
$("#but").css("-webkit-animation","rotating 1.5s 0s linear infinite");
        var audio = document.getElementsByClassName('audio')[0];

            audio.play();

        document.addEventListener("WeixinJSBridgeReady", function () {

            audio.play();

        }, false);

    }

    audioAutoPlay();
});

// 音频播放
function Play(e) {
    var audio = document.getElementsByClassName('audio')[0];

    console.log(audio.paused);

    if(audio.paused){

     audio.play();

        console.log('播放')
        $("#but").css("-webkit-animation","rotating 1.5s 0s linear infinite");

    }else{
$("#but").css("-webkit-animation","");
     audio.pause();

        console.log('暂停')

    }
}

$('.gz').click(function(){
  $('.g').show();
  $('.zz').show();
})
$('.g').click(function(){
  $('.g').hide();
  $('.zz').hide();
})
$('.start').click(function(){
  $('.index').hide();
  $('#canvas').show();
  loadContent();
})
function ajaxs(core){
  $('#canvas').hide();
  $('.core>p').text(core);
  fen = core;
  var token = $("#token").val();
  var openid = $("#openid").val();
  $.ajax({
    type: 'POST',
    dataType:'json',
    url : 'http://omk.douyar.cc/omk/omk_tran.php?step=rank',
    data: {
      core:core,
      openid:openid,
    },
    beforeSend: function(request) { 
      request.setRequestHeader("Authorization", token); 
    }, 
    success: function(data){
      console.log(data);
      $('.core>span').text(data+'%');
      $('.cores').show();
      $('.core').show();
      $('.zz').show();
      $('#canvas').hide();
    }
  });
}

function tj1(){  
  var token = $("#token").val();
  var openid = $("#openid").val();
  var name = $(".name").val();
  var phone = $(".phone").val();
  if (name=="") {alert("请输入您的姓名");return false;}
  if (phone=="") {alert("请输入您的电话");return false;}
  var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
  if (!reg.test(phone)) {
      alert("请输入正确的手机号");
      return false;
  }
  if(aa == 1){
    $.ajax({
      type: 'POST',
      dataType:'json',
      url : 'http://omk.douyar.cc/omk/omk_tran.php?step=info',
      data: {
        name:name,
        phone:phone,
        openid:openid,
      },
      beforeSend: function(request) { 
        request.setRequestHeader("Authorization", token); 
      }, 
      success: function(data){
        console.log(data);
        $('.core').remove();
        if(data.res == 1){
          $('.prize').show();
          $('.prize>p').text('50元');
          $('.core').remove();
        }else if(data.res == 2){
          $('.prize').show();
          $('.prize>p').text('10元');
          $('.core').remove();
        }else if(data.res == 3){
          $('.prize').show();
          $('.prize>p').text('2元');
          $('.core').remove();
        }else if(data.res == 9){
          $('.no-prize').show();
          $('.core').remove();
        }else if(data.res == 10){
          $('.no-prize').show();
          $('.core').remove();
        }
        var nickname = $('#nickname').val();
        wx.onMenuShareAppMessage({
            title:'运输技巧大考验', // 分享标题
            desc: nickname+'以'+fen+'公里的成绩傲视群雄，快来挑战ta赢取丰厚奖品吧！', // 分享描述
            link: 'http://omk.douyar.cc/omk/omk_tran.php', // 分享链接
            imgUrl: 'http://omk.douyar.cc/templates/omk/omk_transport/img/fx.jpg', // 分享图标
            type: '', // 分享类型,music、video或link，不填默认为link
            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
            success: function () {
                //alert("分享成功");
                // 用户确认分享后执行的回调函数
            },
            cancel: function () {
               // alert("取消成功");
                // 用户取消分享后执行的回调函数
            }
        });
      }
    });
  }
  aa=2;
  jump(3);
}
//禁止点击多次
function jump(count) { 
  window.setTimeout(function(){ 
      count--; 
      if(count > 0) { 
          jump(count); 
      } else { 
         aa=1; 
      } 
  }, 2000); 
} 
$('.a2').click(function(){
  $('.f').show();
})
$('.f').click(function(){
  $(this).hide();
})
</script>
</body>
</html>