<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<!-- viewport视图宽度设置      视图宽度 = 设备宽度， 初始化视图大小    可调整的最大宽度   可调整的最小宽度   用户是否可以调整视图宽度-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
	<title>绿途英雄</title>
	<link rel="stylesheet" href="/templates/amkltyx/css/all.css">
	<link rel="stylesheet" href="/templates/amkltyx/css/shou.css">
	<script src="/templates/amkltyx/js/jquery.min.js"></script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
	<script>
        wx.config({
            debug: false, // 开启调试模式调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印�?
            appId: 'wx3a6efa88b590d910', // 必填，公众号的唯一标识
            timestamp: '{$arr.timestamp}', // 必填，生成签名的时间
            nonceStr: '{$arr.noncestr}', // 必填，生成签名的随机
            signature: '{$arr.sha1}',// 必填，签名，见附
            jsApiList: [
                "onMenuShareTimeline",
                "onMenuShareAppMessage"
            ] // 必填，需要使用的JS接口列表，所有JS接口列表见附
        });
        wx.ready(function () {
            wx.onMenuShareAppMessage({
                title: '我是绿途英雄', // 分享标题
                desc: '欧马可携手北京环交所邀您共同保卫首都蓝天', // 分享描述
                link: 'http://amkltyx.douyar.cc', // 分享链接
                imgUrl: 'http://amkltyx.douyar.cc/templates/amkltyx/img/fx.jpg', // 分享图标
                type: '', // 分享类型,music、video或link，不填默认为link
                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function () {

                },
                cancel: function () {
                    //alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }

            });
            wx.onMenuShareTimeline({
                title: '我是绿途英雄', // 分享标题
                link: 'http://amkltyx.douyar.cc', // 分享链接
                imgUrl: 'http://amkltyx.douyar.cc/templates/amkltyx/img/fx.jpg', // 分享图标
                success: function () {

                },
                cancel: function () {
                  //  alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }
            });
        })
    </script>
</head>
<body>
<input type="hidden" id="openid" value="{$openid}">
<input type="hidden" id="token" value="{$token}">
<input type="hidden" id="id" value="{$id}">
<input type="hidden" id="number" value="{$number}">
<input type="hidden" id="jifen" value="{$jifen}">
	<div class="shou">
		<!-- 商品清单 -->
		<div class="spqd">

			<div class="spad_ul">
				<!--{foreach from=$sql item=goods name=goods  }-->	 
				<ul>
					<li id="name">{$goods.name}</li>
					<li id="num">{$goods.num}<span>积分</span></li>
					<li id="cc"><span>X</span>{$goods.cc}</li>
					<li id="zong">{$goods.zong}<span>积分</span></li>
				</ul>
				<!--{/foreach}-->
			</div>

			<div class="hj">
				
				<span>合计：</span>
				<span class="heji">{$he}</span>
				<span>积分</span>

			</div>
		</div>

		<!-- 收货地址 -->

		<div class="shdz">
 
		<select name="select_1" class="inp_1" id="province" onchange="chooseProvince(this)"  style="appearance:none;-moz-appearance:none;-webkit-appearance:none;">
			<option value="0">请选择您的省份</option>

		</select>

		<select name="select_2" class="inp_2" id="city" onChange="chooseCity(this)"  style="appearance:none;-moz-appearance:none;-webkit-appearance:none;">
			<option value="0">请选择您的城市</option>
	
		</select>
		<script src="/templates/amkltyx/js/ld.js"></script>
		 <!-- <textarea name="" placeholder="请输入您的详细地址"   class="inp_3"> -->
		 	<input type="" name="" placeholder="请输入您的详细地址" class="inp_3">
   		 <input type="text" class="inp_4" placeholder="请输入您的姓名">
   		 <input type="text" class="inp_5" placeholder="请输入您的联系方式">

   		 <div class="qr" onclick="qr()"></div>
		</div>
	</div>


	<script type="text/javascript">
		var w = 375;
		var f = 16;
		var c = document.documentElement.clientWidth;
		var nf = c * f / w;
		document.documentElement.style.fontSize = nf + 'px';


		function qr(){
			var openid = $("#openid").val();
			var token = $("#token").val();
			var province = $("#province").find("option:selected").text();
			var city = $("#city").find("option:selected").text();
			var inp3 = $('.inp_3').val();
			var inp4 = $('.inp_4').val();
			var inp5 = $('.inp_5').val();

			var id = $('#id').val();
			var number = $('#number').val();
			var jifen = $('#jifen').val();
			var heji = $('.heji').text();
			if(province=="请选择您的省份"){
				alert('请选择您的省份');
				return;
			}
			if(city=="请选择您的城市"){
				alert('请选择您的城市');
				return;
			}


			if (inp3=="请输入您的详细地址") {
				alert('请输入您的详细地址');
	            return false;
			}
			if (inp3=="") {
				alert('请输入您的详细地址');
	            return false;
			}



			if (inp4=="请输入您的姓名") {
				alert('请输入您的姓名');
	            return false;
			}
			if (inp4=="") {
				alert('请输入您的姓名');
	            return false;
			}
			if (inp5=="") {
				alert('请输入您的联系方式');
	            return false;
			}
			if (inp5=="请输入您的联系方式") {
				alert('请输入您的联系方式');
	            return false;
			}

			var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
	        if (!reg.test(inp5)) {
	            alert("请输入正确的手机号");
	            return false;
	        }

		
			$.ajax({
				type: "POST",
	            url: "/amkltyx.php?step=storage",
	            datType: "application/json",
	            data:{
	            	openid:openid,
	            	province:province,
	            	city:city,
	            	address:inp3,
	            	name:inp4,
	            	phone:inp5,
	            	pid:id,
	            	number:number,
	            	jifen:jifen,
	            	heji:heji
				},
				beforeSend: function(request) { 
					request.setRequestHeader("Authorization", token); 
				}, 
	            success: function (res) {
	            	if(res=="1"){
	            		alert('兑换成功！');
	            		window.location.href='http://amkltyx.douyar.cc';
	            	}
	            }
	        });
		}
	</script>
	
</body>
</html>