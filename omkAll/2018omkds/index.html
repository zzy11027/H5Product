<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title>欧马可</title>
	<link rel="stylesheet" type="text/css" href="/templates/2018omkds/css/style.css">
	<link rel="stylesheet" type="text/css" href="/templates/2018omkds/css/animate.css">
	<script src="/templates/2018omkds/js/jquery.js"></script>
	<script src="/templates/2018omkds/js/1.js"></script>
	<script src="/templates/2018omkds/js/jquery.transit.min.js"></script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
	<script>
        wx.config({
            debug: false, // 开启调试模式调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印�?
            appId: 'wx20f3f0b302417dcd', // 必填，公众号的唯一标识
            timestamp: '{$arr.timestamp}', // 必填，生成签名的时间
            nonceStr: '{$arr.noncestr}', // 必填，生成签名的随机
            signature: '{$arr.sha1}',// 必填，签名，见附
            jsApiList: [
                "onMenuShareTimeline",
                "onMenuShareAppMessage"
            ] // 必填，需要使用的JS接口列表，所有JS接口列表见附
        });
        wx.ready(function () {
            wx.onMenuShareAppMessage({
                title: '超卡大赛，我是冠军', // 分享标题
                desc: '{$desc}', // 分享描述
                link: 'http://omkds.douyar.cc/omkds.php', // 分享链接
                imgUrl: 'http://www.aumantruck.com/mobile/templates/2018qixi/img/fenx.png', // 分享图标
                type: '', // 分享类型,music、video或link，不填默认为link
                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function () {

                },
                cancel: function () {
                    //alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }

            });
            wx.onMenuShareTimeline({
                title: '超卡大赛，我是冠军', // 分享标题
                link: 'http://omkds.douyar.cc/omkds.php', // 分享链接
                imgUrl: 'http://www.aumantruck.com/mobile/templates/2018qixi/img/fenx.png', // 分享图标
                success: function () {

                },
                cancel: function () {
                  //  alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }
            });
        })
    </script>
</head>

<body>


<div class="main" style="display: block;">
	<input type="hidden"  id="openid" value="{$openid}">
	<input type="hidden"  id="nickname" value="{$nickname}">
	<input type="hidden"  id="token" value="{$token}">
	<section class="p1">
		
		<!-- 开始按钮 -->
		<div class="p1-btn-start" onclick="start()"><img src="/templates/2018omkds/img/p1-btn-start.png" alt=""></div>

		<!-- 规则按钮 -->
		<div class="gui">


		</div>

		<!-- 规则弹窗 -->
		<div class="gz">

			<!-- 关闭按钮 -->
			<div class="close">

				
			</div>
		</div>

	</section>


	<section class="p2">

		<!-- 分数 -->
		<div class="fen">

			<p class="p1s">0</p>
		</div>


		<!-- 时间 -->
		<div class="time">

			<p class="p2s">30</p>
		</div>

		<div class="p2-center">


			<div class="p2-car" id="car"></div>
		</div>

		<div class="p2-go"></div>

		<div class="p2-over">

		</div>
	</section>


	<section class="p3">


		<!-- 运送成功 -->
		<div class="form">
		
			<a href="/" class="g"></a>
			<!-- 得分 -->
			<div class="lost-fen">

			</div>

			<!-- 超越 -->
			<div class="lost-cy">

			</div>


			<!-- 抽奖按钮 -->
			<div class="cj" onclick="cj()">


			</div>
			
			<!-- 抽奖按钮 -->
			<a href="http://omkds.douyar.cc/omkds.php" class="cj1">


			</a>

			<!-- 奖项 -->
			<div class="pri_1">
				
				<a href="http://omkds.douyar.cc/omkds.php" class="guanbi1"></a>
				<!-- 点击领取 -->
				<div class="dian" onclick="ling($('.pri_1'))">

				</div>
				
				<!-- 姓名电话 -->
	            <input type="text" name="" class="inp_1" id="names" placeholder="请输入您的姓名">
	            <input type="text" name="" class="inp_2" id="phone" placeholder="请输入您的电话">
				<select name="select_1" class="inp_3" id="sel_1" style="appearance:none;-moz-appearance:none;-webkit-appearance:none;">
				<option value="">请选择您的运输行业</option>
		        <option value="快递快运">快递快运</option>
		        <option value="冷链生鲜">冷链生鲜</option>
		        <option value="危化品运输">危化品运输</option>
		        <option value="日用工业品运输">日用工业品运输</option>
		        <option value="农产品运输">农产品运输</option>
		        <option value="五金建材运输">五金建材运输</option>
		        <option value="酒水饮料运输">酒水饮料运输</option>
		        <option value="杂货运输">杂货运输</option>
		        <option value="工具服务用车">工具服务用车</option>
		        <option value="其它">其它</option>

				</select>
			</div>

			<div class="pri_2">

				<a href="http://omkds.douyar.cc/omkds.php" class="guanbi1"></a>
				<!-- 点击领取 -->
				<div class="dian" onclick="ling($('.pri_2'))">

				</div>
				
				<!-- 姓名电话 -->
	            <input type="text" name="" class="inp_1" id="names" placeholder="请输入您的姓名">
	            <input type="text" name="" class="inp_2" id="phone" placeholder="请输入您的电话">
				<select name="select_1" class="inp_3" id="sel_1" style="appearance:none;-moz-appearance:none;-webkit-appearance:none;">
				<option>冷链</option>
				<option>绿通</option>
				<option>危险品</option>
				<option>快递快运</option>
				<option>其他</option>

				</select>
			</div>

			<div class="pri_3">
				
				<a href="http://omkds.douyar.cc/omkds.php" class="guanbi1"></a>
				<!-- 点击领取 -->
				<div class="dian" onclick="ling($('.pri_3'))">

				</div>
				
				<!-- 姓名电话 -->
	            <input type="text" name="" class="inp_1" id="names" placeholder="请输入您的姓名">
	            <input type="text" name="" class="inp_2" id="phone" placeholder="请输入您的电话">
				<select name="select_1" class="inp_3" id="sel_1" style="appearance:none;-moz-appearance:none;-webkit-appearance:none;">
				<option>冷链</option>
				<option>绿通</option>
				<option>危险品</option>
				<option>快递快运</option>
				<option>其他</option>

				</select>
			</div>

			<div class="pri_4">

				<a href="http://omkds.douyar.cc/omkds.php" class="guanbi1s"></a>
				<!-- 没中奖再来一次 -->
				<a href="/" class="dians">

				</a>

			</div>


			<div class="pri_5">
				
				<a href="http://omkds.douyar.cc/omkds.php" class="guanbi2"></a>
				<a href="http://omkds.douyar.cc/omkds.php" class="guanbi3"></a>

			</div>

			<div class="gx">

			<a href="http://omkds.douyar.cc/omkds.php" class="g"></a>
			<!-- 得分 -->
			<div class="lost-fen">

			</div>

			<!-- 超越 -->
			<div class="lost-cy">

			</div>


			<!-- 抽奖按钮 -->
			<div class="cj" onclick="fenxiang()">


			</div>
			
			<!-- 点击注册 -->
			<a href="http://weixingz.foton.com.cn/member/home/center?sourceSubChannel=0403" class="cj1">


			</a>


			</div>

			<!-- 分享弹窗 -->
			<div class="fenxiang">
				<div class="guan_fx" onclick="gb()">

				</div>

			</div>
		</div>
		
	</section>

	<section class="p4">

		<a href="#" class="guanbi2"></a>
	</section>

</div>


		<!-- 背景音频 -->
		<audio src="/templates/2018omkds/img/1.mp3" id="music" preload="preload" class="audio" autoplay="autoplay"  loop="loop" preload="auto" >
			你的浏览器不支持video元素
		</audio>
		<!-- 错误提示音乐 -->

		<audio src="/templates/2018omkds/img/2.mp3" id="musics_1" preload="preload" class="audio_1">
			你的浏览器不支持video元素
		</audio>

		<!--正确提示音乐 -->

		<audio src="/templates/2018omkds/img/3.mp3" id="musics" preload="preload" class="audio_2">
			你的浏览器不支持video元素
		</audio>


<script src="/templates/2018omkds/js/global.js"></script>


<script>
		var lostfen;
		var lostcy;
		var w = 375;
		var f = 16;
		var c = document.documentElement.clientWidth;
		var nf = c * f / w;
		document.documentElement.style.fontSize = nf + 'px';
		// 游戏操作汽车
		$('#car').drag({

			before: function(e) {

			},

			process: function(e) {


				// console.log(bi)

			},

			end: function(e) {
				var thi = $(this)
			}

		});

		$("body").on("touchmove",function(e){
			e.preventDefault();
		});


		// 点击弹出规则弹窗
		$('.gui').click(function(){

			$('.gz').fadeIn(500);
			$('.start').hide();

		})

		// 关闭按钮
		$('.close').click(function(){

			$('.gz').hide();
			$('.start').show();

		})


		// 游戏倒计时
		var con = $('.p2s').text();
		// 分数
		var car = 0;

		// 获取游戏页高度
		var hei = $("body").height();

		// 获取游戏页宽度
		var wid = $("body").width();
		
		// 倒计时游戏
		var sei;
		function start(){	
				var openid = $("#openid").val();
				var nickname = $("#nickname").val();
				$.ajax({
			        type: "POST",
			        url: "/omkds.php?step=cha",
			        data:{
			        	openid:openid
					},
			        success: function (res) {
		        	if(res==1){
		        		alert("很遗憾，您的游戏次数已用完");
		        		$('.p2s').text('30');
		        		clearTimeout(sei)
		        		return false;
		        	}else{


		        		
					sei = setTimeout(function(){

					var fen = $('.p1s').text();
					var token = $("#token").val();
					GameOver();
					
	        		$('.p2-car').hide();
	        		$('.p3').show();
					$('.form').show();
					$('.lost-fen').text(score+'分');
					
				    $.ajax({
				        type: "POST",
				        url: "/omkds.php?step=insert_bfb",
				        data:{
				        	openid:openid,
							fen:fen
						},
						beforeSend: function(request) { 
							request.setRequestHeader("Authorization", token); 
						}, 
					    success: function (res) {
				        	// 返回超越全国多少人
							$('.lost-cy').text(res+'%');
							lostcy = res;
							wx.onMenuShareAppMessage({
					            title: '超卡大赛，我是冠军', // 分享标题
					            desc: nickname+'以'+fen+'分的成绩称霸赛场，快来挑战ta赢取丰厚奖品吧！', // 分享描述
					            link: 'http://omkds.douyar.cc/omkds.php', // 分享链接
					            imgUrl: 'http://www.aumantruck.com/mobile/templates/2018qixi/img/fenx.png', // 分享图标
					            type: '', // 分享类型,music、video或link，不填默认为link
					            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
					            success: function () {
					                //alert("分享成功");
					                // 用户确认分享后执行的回调函数
					            },
					            cancel: function () {
					               // alert("取消成功");
					                // 用户取消分享后执行的回调函数
					            }

				        	});
					    }
				    	});
					

				},30000);


				var a = setInterval(function(){
					// console.log('开始了!!!!!!!')

					con--;
					// console.log(con)
					if(con <= 0){
						clearInterval(a);
						// 倒计时结束游戏
						// $('.p2-car').hide();
						$('.p2-center').hide();
						// $('.p3').show();
					}
					$('.p2s').text(con+'s')

				},1000)

				}
			}
			})


		}

		// 游戏结束
		function GameOver(){
			// shareData.title = "小轮车我跑了"+score+"米，你行吗？";
			$(".obj").remove();
			stopTimer(t);
			stopTimer(c);

		}

		// 游戏结束
		function stopTimer(t){
			clearTimeout(t);
		}

		function cj(){

			$fen = $('.p1s').text();
			var openid = $("#openid").val();
			var token = $("#token").val();
			if($fen<30){
				alert('您的分数太低,请再次挑战！');
				return false;
			}
			$.ajax({

	            type: "POST",
	            url: "/omkds.php?step=prize",
	            data:{
	            	fen:$fen,
	            	openid:openid
				},
				beforeSend: function(request) { 
					request.setRequestHeader("Authorization", token); 
				}, 
	            success: function (res) {

	            	console.log(res);

	            	if (res == 1) {
	            		// 一等奖
	            		$('.pri_3').show();
	            	}
	            	
	            	if (res == 2) {
	            		// 二等奖
	            		$('.pri_2').show();
	            	}

	            	if(res == 3){
	            		// 三等奖
	            		$('.pri_1').show();
	            	}

	            	if(res == 4){
	            		// 未中奖
	            		$('.pri_4').show();
	            	}

	            }
	        });
		}

		// 领取
		function ling(m){
			$fen = $('.p1s').text();
			$names= $(m).find('input').eq(0).val();
			$phone= $(m).find('input').eq(1).val();
			var openid = $("#openid").val();
			var token = $("#token").val();
			var sel = $(m).find('select option:selected').text();
			if ($names=="请输入您的姓名") {
				alert('请输入您的姓名');
	            return false;
			}
			if ($names=="") {
				alert('请输入您的姓名');
	            return false;
			}
			if ($phone=="") {
				alert('请输入您的电话');
	            return false;
			}
			if ($phone=="请输入您的电话") {
				alert('请输入您的电话');
	            return false;
			}

			var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;

	        if (!reg.test($phone)) {
	            alert("请输入正确的手机号");
	            return false;
	        }
	        
	        $.ajax({

	            type: "POST",
	            url: "/omkds.php?step=info",
	            data:{
	            	openid:openid,
	            	name:$names,
	            	fen:$fen,
	            	phone:$phone,
	            	sel:sel
				},
				beforeSend: function(request) { 
					request.setRequestHeader("Authorization", token); 
				}, 
	            success: function (res) {
	            	if(res==1){
	            		alert('领取成功');
	            		$('.gx').show();
	            		$('.lost-fen').text(score+'分');
	            		$('.lost-cy').text(lostcy+'%');
	            	}
	            
	            }
	        });
		}

		// 适配华为键盘影响布局的问题
		var h = window.innerHeight;
		var myInput = document.getElementById('names');
		var myInputs = document.getElementById('phone');

		myInput.addEventListener('focus',handler,false);
		myInputs.addEventListener('focus',handlers,false);

		function handler(){
			console.log(h)
			$('body').height(h);
// 　　		$('body').height($('body')[0].clientHeight);

		}

		function handlers(){

			$('body').height(h);
// 　　		$('body').height($('body')[0].clientHeight);

		}



		// 移动端默认初始化时暂停播放，改为初始化页面时播放
		document.addEventListener('DOMContentLoaded', function () {
		    function audioAutoPlay() {

		        var audio = document.getElementsByClassName('audio')[0];

		            audio.play();

		        document.addEventListener("WeixinJSBridgeReady", function () {

		            audio.play();

		        }, false);

		    }

		    audioAutoPlay();
		});


		// 点击弹出分享炫耀成绩
		function fenxiang(){
			$('.fenxiang').show();
		}

		function gb(){
			$('.fenxiang').hide();
		}

			// 史上巨坑无比的audio
			function playAudio(audio) {
				if (window.WeixinJSBridge) {
					WeixinJSBridge.invoke('getNetworkType', {}, function (e) {
					    audio.play();
					}, false);
				} else {
					document.addEventListener("WeixinJSBridgeReady", function () {
					    WeixinJSBridge.invoke('getNetworkType', {}, function (e) {
					        audio.play();
					    });
					}, false);
				}
				audio.play();
				return false;
    	}
</script>

</body></html>