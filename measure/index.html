<!DOCTYPE html>1231
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>测一测　你的双十一运力指数碾压了多少老司机</title>
    <link rel="stylesheet" href="templates/measure/css/style.css">
    <script src="templates/measure/js/jquery-3.4.1.min.js"></script>
    <script src="templates/measure/js/index.js"></script>
    <script src="templates/measure/js/html2canvas.js"></script>
    <script src="templates/measure/js/rotaryDraw.js"></script>
    <script src="templates/measure/js/pace.min.js"></script>
    <script src="templates/measure/js/preload.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
        <script>

        wx.config({
            debug: false, // 开启调试模式调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印�?
            appId: 'wxa1ef57725e6a43a9', // 必填，公众号的唯一标识
            timestamp: '{$arr.timestamp}', // 必填，生成签名的时间
            nonceStr: '{$arr.noncestr}', // 必填，生成签名的随机
            signature: '{$arr.sha1}',// 必填，签名，见附
            jsApiList: [
                "onMenuShareTimeline",
                "onMenuShareAppMessage"
            ] // 必填，需要使用的JS接口列表，所有JS接口列表见附
        });
        wx.ready(function () {
            wx.onMenuShareAppMessage({
                title: '测一测　你的双十一运力指数碾压了多少老司机', // 分享标题   
                desc: '点击测试你是什么类型的老司机！分享你的运力指数更是有机会获得来自欧曼的暖心小礼哦～', // 分享描述
                link: 'http://www.aumantruck.com/mobile/measure.php', // 分享链接
                imgUrl: 'http://www.aumantruck.com/mobile/templates/measure/img/share.jpg', // 分享图标
                type: '', // 分享类型,music、video或link，不填默认为link
                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function () {

                },
                cancel: function () {
                    //alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }

            });
            wx.onMenuShareTimeline({
                title: '测一测　你的双十一运力指数碾压了多少老司机', // 分享标题
                link: 'http://www.aumantruck.com/mobile/measure.php', // 分享链接
                imgUrl: 'http://www.aumantruck.com/mobile/templates/measure/img/share.jpg', // 分享图标
                success: function () {

                },
                cancel: function () {
                  //  alert("取消成功");
                    // 用户取消分享后执行的回调函数
                }
            });
        })

    </script>
    <script>
        var arr=[
            'templates/measure/img/creat/share.png',
            'templates/measure/img/index/rules.png',
            'templates/measure/img/index/bg1.png',
            'templates/measure/img/index/bg2.png',
            'templates/measure/img/index/logo.png', 
            'templates/measure/img/index/theme.png',
            'templates/measure/img/index/car.png',
            'templates/measure/img/index/rule.png', 
            'templates/measure/img/index/down.png',
            'templates/measure/img/index/start.png',
            'templates/measure/img/problem/question.png',
            'templates/measure/img/problem/num1.png',
            'templates/measure/img/problem/num2.png',
            'templates/measure/img/problem/num3.png',
            'templates/measure/img/problem/num4.png',
            'templates/measure/img/creat/creat1.png', 
            'templates/measure/img/creat/creat11.png',
            'templates/measure/img/cover.png',
            'templates/measure/img/info.png',
        ]
        //图片预加载
        $.preload(arr, {
            minTimer: 3000,
            //每加载完一张执行的方法
            each: function (count) {
                // var percent = Math.round((count+1) / len * 100) + '%';
                // progressInner.css("width",percent);
                // progressTxt.html(percent);
            },
            // 加载完所有的图片执行的方法
            end: function () {
                console.log('预加载完成');
            }
        });




        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?12ebce5ddde1b698958bacdd8cce7342";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    </script>
    <script>
        window.onresize = setFontSize;
        setFontSize();
        function setFontSize(){
            var designWidth = 750;
            var windowWidth = document.documentElement.clientWidth;
            console.log(windowWidth);
            if(windowWidth > designWidth){
                windowWidth = designWidth;
            }
            document.documentElement.style.fontSize = 32 * (windowWidth / designWidth) + "px";
        }
    </script>
    <style>
        #screenShotImg{
            display:block;
            position:absolute;
            top: 10%;
            left: 0;
            right: 0;
            margin:auto;
            width: 66%;
        }
    </style>
</head>
<body>
    <input type="hidden" name="" id="openid" value="{$openid}">
    <input type="hidden" name="" id="token" value="{$token}">
    <div id="bg">
    </div>
    <div class="success">111</div>
    <img src="templates/measure/img/creat/share.png" alt="" width="25%" class="share tip" id="btnShare">
    <div id="rules">
        <img src="templates/measure/img/index/rules.png" alt="" width="90%">
        <div class="sure">

        </div>
    </div>
    
    <div class="first">
        <div class="bg1">

        </div>
        <!-- <img src="templates/measure/img/index/bg1.png" alt="" width="100%" height="100%" class="bg1"> -->
        <img src="templates/measure/img/index/bg2.png" alt="" width="96%" height="96%" class="bg2">
        <img src="templates/measure/img/index/logo.png" alt="" width="30%" class="logo">
        <img src="templates/measure/img/index/theme.png" alt="" width="100%" class="theme">
        <img src="templates/measure/img/index/car.png" alt="" width="190%" class="car">
        <img src="templates/measure/img/index/rule.png" alt="" width="15%" class="rule">
        <img src="templates/measure/img/index/down.png" alt="" width="60%" class="down" class="down">
        <img src="templates/measure/img/index/start.png" alt="" width="40%" class="start tip">
    </div>
    <div class="problem">
        <div class="bg1"></div>
        <img src="templates/measure/img/index/logo.png" alt="" width="30%" class="logo">
        <!-- <img src="templates/measure/img/index/bg1.png" alt="" width="100%" height="100%" class="bg1"> -->
        <img src="templates/measure/img/index/bg2.png" alt="" width="96%" height="96%" class="bg2">
        <img src="templates/measure/img/problem/question.png" width="90%" alt="" class="question">
        <div class="num1">
            <img src="templates/measure/img/problem/num1.png" width="70%" alt="" class="">
            <div class="radio">
                <input type="radio" name="year" class="gcs-radio" id="n1" />
                <label for="n1" class="n1"></label> 
                <input type="radio" name="year" class="gcs-radio" id="n2" />
                <label for="n2" class="n1"></label>
            </div>
            
        </div>
        <div class="num2">
            <img src="templates/measure/img/problem/num2.png" width="70%" alt="" class="">
            <div class="radio radio2">
                    <input type="radio" name="yunshu" class="gcs-radio" id="y1" />
                    <label for="y1" class="y1"></label> 
                    <input type="radio" name="yunshu" class="gcs-radio yunshu" id="y2" />
                    <label for="y2" class="y1"></label>
            </div>
        </div>
        <div class="num3">
            <img src="templates/measure/img/problem/num3.png" width="70%" alt="" class="">
            <div class="radio radio3">
                    <input type="radio" name="hobby" class="gcs-radio" id="h1" />
                    <label for="h1" class="h1"></label> 
                    <input type="radio" name="hobby" class="gcs-radio" id="h2" />
                    <label for="h2" class="h1"></label>
            </div>
        </div>

        <div class="num4">
            <img src="templates/measure/img/problem/num4.png" width="70%" alt="" class="">
            <div class="radio radio4">
                    <input type="radio" name="time" class="gcs-radio" id="t1" />
                    <label for="t1" class="t1"></label> 
                    <input type="radio" name="time" class="gcs-radio" id="t2" />
                    <label for="t2" class="t1"></label>
            </div>
        </div>
        <img src="templates/measure/img/problem/down1.png" width="60%" alt="" class="down">
        <img src="templates/measure/img/problem/create.png" width="45%" alt="" class="creat tip">
    </div>
    <div id="shareContent">
            <img src="{$headimgurl}" alt="" class="pho">
        <div class="result1">
            <div class="bg1"></div>
        <img src="templates/measure/img/index/logo.png" alt="" width="30%" class="logo">
        <!-- <img src="templates/measure/img/index/bg1.png" alt="" width="100%" height="100%" class="bg1"> -->
        <img src="templates/measure/img/index/bg2.png" alt="" width="96%" height="96%" class="bg2">
        <img src="templates/measure/img/creat/creat1.png" alt="" width="90%" class="creat1">
        <img src="templates/measure/img/creat/creat11.png" alt="" width="60%" class="creat11">
        <img src="templates/measure/img/creat/photo.png" alt="" width="15%" class="photo">
        <div class="star">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
        </div>
        
    </div>
    <div class="result2">
        <div class="bg1"></div>
        <img src="templates/measure/img/index/logo.png" alt="" width="30%" class="logo">
        <!-- <img src="templates/measure/img/index/bg1.png" alt="" width="100%" height="100%" class="bg1"> -->
        <img src="templates/measure/img/index/bg2.png" alt="" width="96%" height="96%" class="bg2">
        <img src="templates/measure/img/creat/creat2.png" alt="" width="90%" class="creat1">
        <img src="templates/measure/img/creat/creat22.png" alt="" width="60%" class="creat22">
        <img src="templates/measure/img/creat/photo.png" alt="" width="15%" class="photo">
        <div class="star">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
        </div>
    </div>
    <div class="result3">
        <div class="bg1"></div>
            <img src="templates/measure/img/index/logo.png" alt="" width="30%" class="logo">
        <!-- <img src="templates/measure/img/index/bg1.png" alt="" width="100%" height="100%" class="bg1"> -->
        <img src="templates/measure/img/index/bg2.png" alt="" width="96%" height="96%" class="bg2">
        <img src="templates/measure/img/creat/creat3.png" alt="" width="90%" class="creat1">
        <img src="templates/measure/img/creat/creat33.png" alt="" width="60%" class="creat33">
        <img src="templates/measure/img/creat/photo.png" alt="" width="15%" class="photo">
        <div class="star">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
        </div>
    </div>
    <div class="result4">
        <div class="bg1"></div>
            <img src="templates/measure/img/index/logo.png" alt="" width="30%" class="logo">
            <!-- <img src="templates/measure/img/index/bg1.png" alt="" width="100%" height="100%" class="bg1"> -->
            <img src="templates/measure/img/index/bg2.png" alt="" width="96%" height="96%" class="bg2">
            <img src="templates/measure/img/creat/creat4.png" alt="" width="90%" class="creat1">
            <img src="templates/measure/img/creat/creat44.png" alt="" width="60%" class="creat44">
            <img src="templates/measure/img/creat/photo.png" alt="" width="15%" class="photo">
            <div class="star">
                <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
                <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
                <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
                <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
                <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            </div>
    </div>
    <div class="result5">
        <div class="bg1"></div>
            <img src="templates/measure/img/index/logo.png" alt="" width="30%" class="logo">
            <!-- <img src="templates/measure/img/index/bg1.png" alt="" width="100%" height="100%" class="bg1"> -->
            <img src="templates/measure/img/index/bg2.png" alt="" width="96%" height="96%" class="bg2">
            <img src="templates/measure/img/creat/creat5.png" alt="" width="90%" class="creat1">
            <img src="templates/measure/img/creat/creat55.png" alt="" width="60%" class="creat55">
            <img src="templates/measure/img/creat/photo.png" alt="" width="15%" class="photo">
            <div class="star">
                <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
                <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
                <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
                <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
                <img src="templates/measure/img/creat/star.png" alt="" width="11%" class="star1">
            </div>
    </div>
    </div>
    <div class="share-pho">
        <img id="screenShotImg">
        <img src="templates/measure/img/cover.png" alt="" width="100%" height="100%" class="cover">
        <div class="goPrize"></div>
    </div>
    <div class="info">
        <div class="bg1"></div>
            <!-- <img src="templates/measure/img/index/bg1.png" alt="" width="100%" height="100%" class="bg1"> -->
            <div class="bg"></div>
            <div class="info1">
                <img src="templates/measure/img/info.png" alt="" width="96%" >
                <input type="text" name="" id="" class="name">
            <input type="text" name="" id="" class="tel">
            <input type="text" name="" id="" class="address">
            <div class="btn"></div>
            </div>
            
            
    </div>
    <div class="lotto">
            <div class="bg1"></div>
            <!-- <img src="templates/measure/img/index/bg1.png" alt="" width="100%" height="100%" class="bg1"> -->
            <img src="templates/measure/img/index/bg2.png" alt="" width="96%" height="96%" class="bg2">
            
            <img src="templates/measure/img/index/logo.png" alt="" width="30%" class="logo">
            
            <img src="templates/measure/img/ride/ride-bg.png" alt="" width="90%" class="ride-bg">
            <img src="templates/measure/img/ride/title.png" alt="" width="60%" class="title1">
            <img src="templates/measure/img/ride/shadow.png" alt="" width="50%" class="shadow">
            <img src="templates/measure/img/ride/big-rid.png" alt="" width="70%" class="big-rid">
            <img src="templates/measure/img/ride/cirle.png" alt="" width="30%" class="cirle">
            <img src="templates/measure/img/ride/click.png" alt="" width="10%" class="click">
        </div>
    <div class="prize">
            <div class="bg1"></div>
            <!-- <img src="templates/measure/img/index/bg1.png" alt="" width="100%" height="100%" class="bg1"> -->
            <div class="bg"></div>
            <div class="prize1">
                <img src="templates/measure/img/prize.png" alt="" width="96%" >
                <div class="btn1"></div>
            </div>
            
            
            <p class="edit">111</p>
    </div>
    <div class="pity">
        <div class="bg1"></div>
            <!-- <img src="templates/measure/img/index/bg1.png" alt="" width="100%" height="100%" class="bg1"> -->
            <div class="bg"></div>
            <div class="pity1">
                <img src="templates/measure/img/pity.png" alt="" width="96%" class="">
                <div class="btn2"></div>
            </div>
            
            
    </div>
    <audio style="display:none; height: 0" id="bg-music" preload="auto" src="templates/measure/img/bg-music.mp3" loop="loop"></audio>
    <script>

document.addEventListener('DOMContentLoaded', function () {
    function audioAutoPlay() {
        var audio = document.getElementById('bg-music');
            audio.play();
        document.addEventListener("WeixinJSBridgeReady", function () {
            audio.play();
        }, false);
    }
    audioAutoPlay();
});
         //定义查找元素方法
    function $aa(selector) {
        return document.querySelector(selector);
    }
    var main = {
        init:function(){
            main.setListener();
        },
        //设置监听事件
        setListener:function(){
            var btnShare = document.getElementById("btnShare");
            console.log(btnShare)
            btnShare.onclick = function(){
                main.html2Canvas();
                
            }
        },
        //获取像素密度
        getPixelRatio:function(context){
            var backingStore = context.backingStorePixelRatio ||
                    context.webkitBackingStorePixelRatio ||
                    context.mozBackingStorePixelRatio ||
                    context.msBackingStorePixelRatio ||
                    context.oBackingStorePixelRatio ||
                    context.backingStorePixelRatio || 1;
            return (window.devicePixelRatio || 1) / backingStore;
        },
        //绘制dom 元素，生成截图canvas
        html2Canvas: function () {
            var shareContent = $aa("#shareContent");// 需要绘制的部分的 (原生）dom 对象 ，注意容器的宽度不要使用百分比，使用固定宽度，避免缩放问题
            var width = shareContent.offsetWidth;  // 获取(原生）dom 宽度
            var height = shareContent.offsetHeight; // 获取(原生）dom 高
            var offsetTop = shareContent.offsetTop;  //元素距离顶部的偏移量

            var canvas = document.createElement('canvas');  //创建canvas 对象
            var context = canvas.getContext('2d');
            var scaleBy = main.getPixelRatio(context);  //获取像素密度的方法 (也可以采用自定义缩放比例)
            canvas.width = width * scaleBy;   //这里 由于绘制的dom 为固定宽度，居中，所以没有偏移
            canvas.height = (height + offsetTop) * scaleBy;  // 注意高度问题，由于顶部有个距离所以要加上顶部的距离，解决图像高度偏移问题
            context.scale(scaleBy, scaleBy);

            var opts = {
                allowTaint:true,//允许加载跨域的图片
                tainttest:true, //检测每张图片都已经加载完成
                scale:scaleBy, // 添加的scale 参数
                canvas:canvas, //自定义 canvas
                logging: true, //日志开关，发布的时候记得改成false
                width:width, //dom 原始宽度
                height:height //dom 原始高度
            };
            html2canvas(shareContent, opts).then(function (canvas) {
               console.log("html2canvas");
                var body = document.getElementsByTagName("body");
                body[0].appendChild(canvas);
            	canvas.style.width = '100%';
		        var dataUrl = canvas.toDataURL('image/png',0.5);
                document.getElementById("screenShotImg").src = dataUrl;
                alert($('#screenShotImg').attr('src'));
                canvas.style.display='none';
            });
        }
    };

    //最后运行代码
    main.init();
    </script>
</body>
</html>